import works from"../data/works.js";import{createApp}from"./petite-vue@0.4.1.js";import{getParamsByUrl,getRandomNum,isVisible}from"./utils.js";const titleEl=document.querySelector("#title"),originalHref=window.location.href,STORAGE_KEY="ghibli-album-id",albumIdxStorage={fetch:()=>JSON.parse(localStorage.getItem(STORAGE_KEY)),save(e){localStorage.setItem(STORAGE_KEY,JSON.stringify(e))},remove(){localStorage.removeItem(STORAGE_KEY)}},App={works:works,isLoading:!0,isTopButtonHide:!0,currentAlbumIdx:0,get language(){const{en:e}=getParamsByUrl();return e?"en":"jp"},get currentAlbum(){return this.works[this.currentAlbumIdx]},get bodyStyle(){if(this.isLoading)return"overflow: hidden;"},init(){const e=albumIdxStorage.fetch();if(e)return this.currentAlbumIdx=e;this.currentAlbumIdx=getRandomNum(0,this.works.length),albumIdxStorage.save(this.currentAlbumIdx)},endLoading(e){setTimeout((()=>this.isLoading=!1),1e3*e)},handleScroll(){if(isVisible(titleEl))return this.isTopButtonHide=!0;this.isTopButtonHide=!1},moveToTop(){window.scrollTo(0,0)},getImageUrl(e){return`https://www.ghibli.jp/gallery/${this.currentAlbum.albumFolder}${String(e+1).padStart(3,"0")}.jpg`},changeAlbum(e){this.currentAlbumIdx=e,albumIdxStorage.save(this.currentAlbumIdx),setTimeout((()=>{window.history.replaceState({},"",originalHref)}))}};createApp(App).mount(),window.onload=()=>{App.moveToTop(),App.endLoading(1.5)},window.onscroll=()=>App.handleScroll(),window.onfocus=()=>albumIdxStorage.save(App.currentAlbumIdx),window.onblur=()=>albumIdxStorage.remove();