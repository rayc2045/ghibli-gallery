import{createApp,reactive}from"./petite-vue@0.4.1.js";import{getQueryParams,getRandomNum,isVisible}from"./utils.js";import works from"../data/works.js";const titleEl=document.querySelector("#title"),originalHref=window.location.href,galleryEndpoint="https://www.ghibli.jp/gallery/",STORAGE_KEY="ghibli-album-id",albumIdxStorage={fetch:()=>JSON.parse(localStorage.getItem(STORAGE_KEY)),save(id){localStorage.setItem(STORAGE_KEY,JSON.stringify(id))},remove(){localStorage.removeItem(STORAGE_KEY)}},Slider=reactive({isShow:!1,isCloseButtonShow:!1,currentImageUrl:`${galleryEndpoint}${works[0].albumFolder}001.jpg`,get max(){return works.find(album=>this.currentImageUrl.includes(album.albumFolder)).numOfImages},get currentImageIdx(){return Number(this.currentImageUrl.slice(-7).split(".")[0])},get progress(){return`${String(this.currentImageIdx).padStart(String(this.max).length,"0")} / ${this.max}`},showSlider(url){this.isShow=!0,this.currentImageUrl=url},handleMouseMove(){this.isCloseButtonShow||(this.isCloseButtonShow=!0,setTimeout(()=>this.isCloseButtonShow=!1,2e3))},prev(){const prevPadIdx=`${String(1===this.currentImageIdx?this.max:this.currentImageIdx-1).padStart(3,"0")}.jpg`;this.currentImageUrl=this.currentImageUrl.replace(this.currentImageUrl.slice(-7),prevPadIdx)},next(){const nextPadIdx=`${String(this.currentImageIdx===this.max?1:this.currentImageIdx+1).padStart(3,"0")}.jpg`;this.currentImageUrl=this.currentImageUrl.replace(this.currentImageUrl.slice(-7),nextPadIdx)},close(){this.isShow=this.isCloseButtonShow=!1}}),App={works:works,Slider:Slider,language:"en"in getQueryParams()?"en":"jp",isLoading:!0,isTopButtonHide:!0,currentAlbumIdx:0,get currentAlbum(){return this.works[this.currentAlbumIdx]},get bodyStyle(){return this.isLoading?"overflow: hidden;":Slider.isShow?"overflow: hidden;":""},get bodyWidth(){return document.body.clientWidth},init(){const localAlbumIdx=albumIdxStorage.fetch();if(localAlbumIdx)return this.currentAlbumIdx=localAlbumIdx;this.currentAlbumIdx=getRandomNum(0,this.works.length),albumIdxStorage.save(this.currentAlbumIdx)},endLoading(sec){setTimeout(()=>this.isLoading=!1,1e3*sec)},handleScroll(){if(isVisible(titleEl))return this.isTopButtonHide=!0;this.isTopButtonHide=!1},moveToTop(){window.scrollTo(0,0)},getImageUrl(idx){return`${galleryEndpoint}${this.currentAlbum.albumFolder}${String(idx+1).padStart(3,"0")}.jpg`},changeAlbum(idx){this.currentAlbumIdx=idx,albumIdxStorage.save(this.currentAlbumIdx),setTimeout(()=>{window.history.replaceState({},"",originalHref)})}};createApp(App).mount(),window.onload=()=>{App.moveToTop(),App.endLoading(1)},window.onscroll=()=>App.handleScroll(),window.onresize=()=>Slider.close(),window.onfocus=()=>albumIdxStorage.save(App.currentAlbumIdx),window.onblur=()=>albumIdxStorage.remove();